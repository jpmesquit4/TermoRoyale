<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Termo Royale</title>
    <link rel="stylesheet" href="index.css">
</head>

<body>

    <main>

        <header>

            <div class="left">
                <h1>termo royale<span>.</span></h1>
            </div>

            <div class="center">
                    <a href="/index.html">Cl√°ssico</a>
                    <a href="/pages/carta/index.html">Carta</a>
                    <a href="/pages/regras/index.html" target="_blank">Como jogar</a>
            </div>

            <div>
                <p></p>
            </div>

        </header>

        <div class="menu-center">

                <div class="apresentation">
                    <img src="/images/logo.png" alt="">
                    <p>Ol√°, Seja bem-vindo ao <br> <span>Termo Royale</span></p>
                </div>

            <div class="guess-center">
                <input id="nomeCarta" autocomplete="off" type="text" placeholder="Digite o nome da carta"
                    onkeydown="if(event.key==='Enter'){jogar()}">
                
                <button onclick="jogar()" class="search-icon">
                    <img src="/images/lupa.png" alt="">
                </button>
            </div>

            <div class="titulos">
                <p id="nome">Nome</p>
                <p>Elixir</p>
                <p>Imagem</p>
                <p id="raridade">Raridade</p>
                <p id="Evo">Evo</p>
                <p id="heroi">Her√≥i</p>
            </div>

            <div id="tentativas"></div>

        </div>

    </main>


    <script src="pull.js"></script>

    <script>

        function normalizar(str) {
            return str
                    .normalize("NFD")
                    .replace(/[\u0300-\u036f]/g, "") // remove acentos
                    .replace(/[^a-z0-9]/gi, "")      // remove tudo que n√£o √© letra/n√∫mero
                    .toLowerCase()
                    .trim();
        }


        window.addEventListener("load", () => {
            document.getElementById("popupVitoria").style.display = "none";
        });

        let jogoFinalizado = false;   // bloqueia ap√≥s vit√≥ria
        let resposta; // carta sorteada

        // Sorteia 1 carta assim que o jogo inicia
        window.onload = function () {
            const total = allCards.items.length;
            resposta = allCards.items[Math.floor(Math.random() * total)];
            //console.log("CARTA SECRETA:", resposta.name); // debug
        };

        function jogar() {

            if (jogoFinalizado) return;

            const nome = document.getElementById("nomeCarta").value.trim();

            if (!nome) return;

            const nomeNormalizado = normalizar(nome);

            const carta = allCards.items.find(c => {
                const nomeCarta = normalizar(c.name);

                // Caso especial: O Tronco
                if (nomeCarta === "otronco" && nomeNormalizado === "tronco") {
                    return true;
                }

                return nomeCarta === nomeNormalizado;
            });


            // ‚õî Se n√£o encontrar carta, n√£o deixa continuar
            if (!carta) {
                mostrarPopup(
                    "Carta inv√°lida",
                    "Essa carta n√£o existe. Verifique o nome e tente novamente.",
                    "erro"
                );
                return;
            }

            criarTentativa(carta);
            document.getElementById("nomeCarta").value = "";
        }


        let tentativasFeitas = 0;

        function criarTentativa(carta) {
             tentativasFeitas++;

            const linha = document.createElement("div");
            linha.classList.add("linha");

            // Nome
            const quadNome = criaQuadrado(carta ? carta.name : "???");

            // Raridade
            const quadRaridade = criaQuadrado(carta ? carta.rarity : "raridade nao encontrada");

            // Elixir
            const quadElixir = criaQuadrado(carta ? carta.elixirCost : "-");

            // √çcone Padr√£o
            const quadIcon = document.createElement("div");
            quadIcon.classList.add("quadrado");
            if (carta) {
                let img = document.createElement("img");
                img.src = carta.iconUrls.medium;
                img.style.width = "40px";
                img.classList.add("quad-img");
                quadIcon.appendChild(img);
            } else {
                quadIcon.textContent = "‚ùå";
            }

            // √çcone Evo
            // √çcone Evo (mostra se possui ou n√£o)
            const quadIconEvo = document.createElement("div");
            quadIconEvo.classList.add("quadrado");

            if (carta.iconUrls.evolutionMedium && carta.iconUrls.evolutionMedium.trim() !== "") {
                quadIconEvo.textContent = "‚úîÔ∏è";
                quadIconEvo.style.fontSize = "32px";
                quadIconEvo.style.color = "green";
            } else {
                quadIconEvo.textContent = "‚ùå";
            }


            // √çcone Heroica
            const quadIconHeroica = document.createElement("div");
            quadIconHeroica.classList.add("quadrado");

            if (carta.iconUrls.heroMedium && carta.iconUrls.heroMedium.trim() !== "") {
                quadIconHeroica.textContent = "‚úîÔ∏è";
                quadIconHeroica.style.fontSize = "32px";
                quadIconHeroica.style.color = "green";
            } else {
                quadIconHeroica.textContent = "‚ùå";
            }

            // Adiciona quadrados √† linha
            linha.appendChild(quadNome);
            linha.appendChild(quadElixir);
            linha.appendChild(quadIcon);
            linha.appendChild(quadRaridade);
            linha.appendChild(quadIconEvo);
            linha.appendChild(quadIconHeroica);

            // Colore conforme o resultado
            colorir(quadNome, quadElixir, quadIcon, quadRaridade, quadIconEvo, quadIconHeroica, carta);

            // Adiciona na tela
            document.getElementById("tentativas").prepend(linha);
        }

        function criaQuadrado(texto) {
            const div = document.createElement("div");
            div.classList.add("quadrado");
            div.textContent = texto;
            return div;
        }

        function colorir(nomeQuad, elixirQuad, iconQuad, RaridadeQuad, iconEvoQuad, iconHeroicaQuad, carta) {

            if (carta.name === resposta.name) {
                nomeQuad.classList.add("verde");
                elixirQuad.classList.add("verde");
                iconQuad.classList.add("verde");
                RaridadeQuad.classList.add("verde");
                iconEvoQuad.classList.add("verde");
                iconHeroicaQuad.classList.add("verde");

                jogoFinalizado = true; // ‚úÖ Para o jogo
                
                mostrarPopup(
                    "Vit√≥ria!",
                    `Voc√™ acertou a carta secreta em <strong>${tentativasFeitas}</strong> tentativas!`,
                    "vitoria"
                );

                return;
            }

            // Caso a carta n√£o exista
            if (!carta) {
                nomeQuad.classList.add("vermelho");
                elixirQuad.classList.add("vermelho");
                iconQuad.classList.add("vermelho");
                iconEvoQuad.classList.add("vermelho");
                iconHeroicaQuad.classList.add("vermelho");
                RaridadeQuad.classList.add("vermelho");
                return;
            }

            // NOME
            if (carta.name === resposta.name) {
                nomeQuad.classList.add("verde");
            } else if (carta.name[0] === resposta.name[0]) {
                nomeQuad.classList.add("amarelo"); // exemplo de parcial
            } else {
                nomeQuad.classList.add("vermelho");
            }

            // ELIXIR
            if (carta.elixirCost === resposta.elixirCost) {
                elixirQuad.classList.add("verde");
            } else if (Math.abs(carta.elixirCost - resposta.elixirCost) <= 1) {
                elixirQuad.classList.add("amarelo");
            } else {
                elixirQuad.classList.add("vermelho");
            }

            // √çCONE
            if (carta.name === resposta.name) {
                iconQuad.classList.add("verde");
            } else {
                iconQuad.classList.add("vermelho");
            }

            // EVO
            const temEvo = carta.iconUrls.evolutionMedium && carta.iconUrls.evolutionMedium.trim() !== "";
            const respostaTemEvo = resposta.iconUrls.evolutionMedium && resposta.iconUrls.evolutionMedium.trim() !== "";

            // Acertou a carta!
            if (carta.name === resposta.name) {
                iconEvoQuad.textContent = respostaTemEvo ? "‚úîÔ∏è" : "‚úñ";
                iconEvoQuad.classList.add("verde");
            } else {
                // Se ambos t√™m evo OU ambos n√£o t√™m evo ‚Üí verde
                if (temEvo === respostaTemEvo) {
                    iconEvoQuad.classList.add("verde");
                } else {
                    iconEvoQuad.classList.add("vermelho");
                }
            }



            // HEROICO
            const temHero = carta.iconUrls.heroMedium && carta.iconUrls.heroMedium.trim() !== "";
            const respostaTemHero = resposta.iconUrls.heroMedium && resposta.iconUrls.heroMedium.trim() !== "";

            // Acertou a carta
            if (carta.name === resposta.name) {
                iconHeroicaQuad.textContent = respostaTemHero ? "‚úîÔ∏è" : "‚úñ";
                iconHeroicaQuad.classList.add("verde");
            } else {
                // CORRE√á√ÉO AQUI! ‚Üí verde quando AMBOS t√™m OU AMBOS N√ÉO t√™m heroico
                if (temHero === respostaTemHero) {
                    iconHeroicaQuad.classList.add("verde");
                } else {
                    iconHeroicaQuad.classList.add("vermelho");
                }
            }





            //Raridade
            if (carta.rarity === resposta.rarity) {
                RaridadeQuad.classList.add("verde");
            } else {
                RaridadeQuad.classList.add("vermelho");
            }



        }

        function mostrarPopup(titulo = "", texto = "", tipo = "erro") {
            const popup = document.getElementById("popup");
            const content = popup.querySelector(".popup-content");

            const btnReiniciar = document.getElementById("btnReiniciar");
            const btnFechar = document.getElementById("btnFechar");

            document.getElementById("popupTitle").innerText = titulo;
            document.getElementById("popupText").innerHTML = texto;

            content.classList.remove("erro", "vitoria");
            content.classList.add(tipo);

            // üî• CONTROLE DOS BOT√ïES
            if (tipo === "vitoria") {
                btnReiniciar.style.display = "inline-block";
                btnFechar.style.display = "inline-block";
            } else {
                btnReiniciar.style.display = "none";
                btnFechar.style.display = "inline-block";
            }

            popup.classList.remove("hidden");
        }



        function fecharPopup() {
            document.getElementById("popup").classList.add("hidden");
        }





    </script>

    <div id="popup" class="popup hidden">
        <div class="popup-content">
            <h2 id="popupTitle"></h2>
            <p id="popupText"></p>

            <div class="popup-buttons">
                <button id="btnFechar" onclick="fecharPopup()">Fechar</button>
                <button id="btnReiniciar" onclick="location.reload()">Tentar novamente</button>
            </div>
        </div>
    </div>



</body>

</html>